# .env.sample — copy to .env and edit for local runs
# DO NOT commit your .env with secrets to git. This file documents safe defaults.

# Image settings
COCKROACH_IMAGE=cockroachdb/cockroach
COCKROACH_TAG=v25.4.3

# Cluster and topology
CLUSTER_NAME=local-cockroach
JOIN_HOSTS=cockroach1:26257,cockroach2:26257,cockroach3:26257

# Host ports for each node (hostPort:containerPort mapping uses container ports 26257/8080)
# Use distinct host ports so multiple nodes can be reached from the host machine.
SQL_PORT_1=26257
SQL_PORT_2=26258
SQL_PORT_3=26259
HTTP_PORT_1=8080
HTTP_PORT_2=8081
HTTP_PORT_3=8082

# Data volumes prefix (named volumes will be <prefix>-1, <prefix>-2, ...)
DATA_VOLUME_PREFIX=cockroach-data

# Cockroach start flags (kept conservative for local dev).
COCKROACH_START_FLAGS=--cache=25% --max-sql-memory=25%

# Toggle persistence of data volumes. For ephemeral clusters set to "false".
PERSIST_DATA=true

# Restart policy for containers (unless-stopped is reasonable for local dev)
RESTART_POLICY=unless-stopped

# Init host/port used by the init job (can be changed if you expose different host ports)
INIT_HOST=cockroach1:26257

# Liquibase env moved to liquibase/.env.sample (copy to liquibase/.env for local runs)
# See liquibase/README.md for details.

# Notes:
# - For local development we use --insecure by default to avoid cert setup complexity.
# - TODO: switch to TLS/certs for any shared or production-like runs. See README.md for steps.

# Additional documentation (read-only guidance below) ---------------------------------
# JOIN_HOSTS
# - Format: a comma-separated list of service:port entries (example: cockroach1:26257,cockroach2:26257,cockroach3:26257)
# - If JOIN_HOSTS is not provided, the compose file has a sensible fallback so nodes will join each other
#   using the standard local service names.
#
# COCKROACH_START_FLAGS
# - NOTE: the Compose `command:` entries are provided in YAML list form in docker-compose.yml. If you set
#   multiple space-separated flags in COCKROACH_START_FLAGS they cannot be expanded into the list form
#   automatically. Prefer editing `docker-compose.yml` and add extra flags as separate list items.
#
# DATA_VOLUME_PREFIX & PERSIST_DATA
# - If PERSIST_DATA=true the compose stack will use named volumes for node data (persist across restarts).
# - If you want ephemeral clusters for testing, set PERSIST_DATA=false and delete volumes when done.
#
# Quick usage (macOS zsh) — copy/paste
# 1) Copy to .env and review
#    cp .env.sample .env
#    # edit .env if you want to change ports or the image tag
#
# 2) Start a clean cluster (removes named volumes; destructive)
#    docker-compose --env-file .env down -v
#    docker-compose --env-file .env up -d
#
# 3) Run the init job manually (idempotent)
#    docker-compose --env-file .env run --rm init
#
# 4) Verify nodes and logs
#    docker-compose --env-file .env ps
#    docker-compose --env-file .env logs -f --tail=200 cockroach1 cockroach2 cockroach3
#    docker-compose --env-file .env exec cockroach1 /cockroach/cockroach node status --insecure --host=localhost:26257
#
# Running tools / clients from outside the compose network (macOS)
# - When a client container runs outside the compose network (for example the Liquibase container or a
#   local process on macOS), use host.docker.internal as the host to reach services bound to the host ports
#   (for example: jdbc:postgresql://host.docker.internal:26257/defaultdb?sslmode=disable).
# - If you run a container inside the compose network, use the Cockroach service names (cockroach1:26257).
#
# CI & image tagging (recommended)
# - Pin image tags for reproducible builds. Consider tagging images with semantic version + short git SHA
#   (example: v25.4.3+githash) and using that in COCKROACH_TAG for CI pipelines.
#
# Security notes & TODO
# - This repository's local compose stack runs CockroachDB in --insecure mode for convenience. Do NOT
#   use --insecure in production. TODO: generate certs, mount them into each node, and switch to
#   --certs-dir in docker-compose.yml and the init script.
# - Never place passwords, private keys, or other secrets in .env files committed to Git. Use a secret manager
#   for production credentials.
# ---------------------------------------------------------------------------------------
