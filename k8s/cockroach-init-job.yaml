apiVersion: batch/v1
kind: Job
metadata:
  name: cockroach-init
  labels:
    app: cockroach
spec:
  backoffLimit: 3
  template:
    metadata:
      labels:
        app: cockroach
    spec:
      restartPolicy: OnFailure
      containers:
        - name: init
          image: cockroachdb/cockroach:v25.4.3
          imagePullPolicy: IfNotPresent
          command:
            - /cockroach-scripts/init-cockroach.sh
          env:
            - name: INIT_HOST
              value: cockroach-east-0.cockroach-east:26257
          volumeMounts:
            - name: cockroach-scripts
              mountPath: /cockroach-scripts
              readOnly: true
      volumes:
        - name: cockroach-scripts
          configMap:
            name: cockroach-scripts
            defaultMode: 0755
  # Security rationale: idempotent init job can be gated via CI/job retries; secrets should be injected before enabling --certs-dir.

